// SPDX-License-Identifier: GPL-2.0
/*
 * Copyright (C) 2022 - 2023 PHYTEC Messtechnik GmbH
 * Author: Wadim Egorov <w.egorov@phytec.de>
 *
 * Product homepage:
 * https://www.phytec.com/product/phyboard-am62x
 */

#include <dt-bindings/gpio/gpio.h>
#include <dt-bindings/input/input.h>
#include <dt-bindings/leds/common.h>
#include <dt-bindings/net/ti-dp83867.h>
#include "k3-am625.dtsi"
#include "k3-am62-phycore-som.dtsi"

/ {
    compatible = "phytec,am625-phyboard-lyra-rdk",
             "phytec,am62-phycore-som", "ti,am625";
    model = "PHYTEC phyBOARD-Lyra AM625";

    aliases {
        serial2 = &main_uart0;
        serial3 = &main_uart1;
        mmc1 = &sdhci1;
        usb0 = &usb0;
        usb1 = &usb1;
        ethernet1 = &cpsw_port2;
    };

    /* this node is used a placeholder to setup all the gateway GPIO pinmux */
    leds {
        compatible = "gpio-leds";
        pinctrl-names = "default";
        pinctrl-0 = <&gateway_pins_default>;
    };

    vcc_1v8: regulator-vcc-1v8 {
        compatible = "regulator-fixed";
        regulator-name = "VCC_1V8";
        regulator-min-microvolt = <1800000>;
        regulator-max-microvolt = <1800000>;
        regulator-always-on;
        regulator-boot-on;
    };

    vcc_3v3_mmc: regulator-vcc-3v3-mmc {
        compatible = "regulator-fixed";
        regulator-name = "VCC_3V3_MMC";
        regulator-min-microvolt = <3300000>;
        regulator-max-microvolt = <3300000>;
        regulator-always-on;
        regulator-boot-on;
    };

    vcc_3v3_sw: regulator-vcc-3v3-sw {
        compatible = "regulator-fixed";
        regulator-name = "VCC_3V3_SW";
        regulator-min-microvolt = <3300000>;
        regulator-max-microvolt = <3300000>;
        regulator-always-on;
        regulator-boot-on;
    };
};

&main_pmx0 {
    gateway_pins_default: gateway-pins-default {
        pinctrl-single,pins = <
            AM62X_IOPAD(0x07C, PIN_INPUT|PIN_OUTPUT , 7) /* mRST_MCU_L     : GPMC0_CLK.GPIO0_31      */
            AM62X_IOPAD(0x0C0, PIN_INPUT            , 7) /* mPG_24V_L 	   : VOUT0_DATA2.GPIO0_47    */
            AM62X_IOPAD(0x098, PIN_INPUT|PIN_OUTPUT , 7) /* mGPIO_INT_SOM  : GPMC0_WAIT0.GPIO0_37    */
            AM62X_IOPAD(0x09C, PIN_INPUT|PIN_OUTPUT , 7) /* mBOOT_MCU0	   : GPMC0_WAIT1.GPIO0_38    */
            AM62X_IOPAD(0x0A0, PIN_INPUT|PIN_OUTPUT , 7) /* mBOOT_MCU1	   : GPMC0_WPn.GPIO0_39      */
            AM62X_IOPAD(0x094, PIN_INPUT|PIN_OUTPUT , 7) /* mMCU_GPIO_PHY1 : GPMC0_BE1n.GPIO0_36     */
            AM62X_IOPAD(0x088, PIN_INPUT|PIN_OUTPUT , 7) /* mMCU_GPIO_PHY2 : GPMC0_OEn_REn.GPIO0_33  */
            AM62X_IOPAD(0x090, PIN_INPUT|PIN_OUTPUT , 7) /* mMCU_GPIO_PHY3 : GPMC0_BE0n_CLE.GPIO0_35 */
            AM62X_IOPAD(0x084, PIN_INPUT|PIN_OUTPUT , 7) /* mMCU_GPIO_PHY4 : GPMC0_ADVn_ALE.GPIO0_32 */
            AM62X_IOPAD(0x08C, PIN_INPUT|PIN_OUTPUT , 7) /* mMCU_GPIO_PHY5 : GPMC0_WEn.GPIO0_34      */
            AM62X_IOPAD(0x0A8, PIN_INPUT|PIN_OUTPUT , 7) /* mMCU_GPIO_PHY6 : GPMC0_CSn0.GPIO0_41     */
            /* below pinmux is to make sure these dont get mapped to UART1 TXD/RXD by mapping these to GPIO */
            AM62X_IOPAD(0x1ac, PIN_INPUT            , 7) /* (E19) MCASP0_AFSR.GPIO1_13 */
            AM62X_IOPAD(0x1b0, PIN_OUTPUT           , 7) /* (A20) MCASP0_ACLKR.GPIO1_14 */
        >;
    };

    main_uart0_pins_default: main-uart0-pins-default {
        pinctrl-single,pins = <
            AM62X_IOPAD(0x1c8, PIN_INPUT, 0)  /* (D14) UART0_RXD */
            AM62X_IOPAD(0x1cc, PIN_OUTPUT, 0) /* (E14) UART0_TXD */
        >;
    };

    main_uart1_pins_default: main-uart1-pins-default {
        pinctrl-single,pins = <
            AM62X_IOPAD(0x1EC, PIN_OUTPUT, 1) /* mUART_TX_SOM: I2C1_SDA.UART1_TX */
            AM62X_IOPAD(0x1E8, PIN_INPUT, 1)  /* mUART_RX_SOM: I2C1_SCL.UART1_RX */
        >;
    };

    main_mmc1_pins_default: main-mmc1-pins-default {
        pinctrl-single,pins = <
            AM62X_IOPAD(0x23c, PIN_INPUT_PULLUP, 0) /* (A21) MMC1_CMD */
            AM62X_IOPAD(0x234, PIN_INPUT_PULLDOWN, 0) /* (B22) MMC1_CLK */
            AM62X_IOPAD(0x230, PIN_INPUT_PULLUP, 0) /* (A22) MMC1_DAT0 */
            AM62X_IOPAD(0x22c, PIN_INPUT_PULLUP, 0) /* (B21) MMC1_DAT1 */
            AM62X_IOPAD(0x228, PIN_INPUT_PULLUP, 0) /* (C21) MMC1_DAT2 */
            AM62X_IOPAD(0x224, PIN_INPUT_PULLUP, 0) /* (D22) MMC1_DAT3 */
            AM62X_IOPAD(0x240, PIN_INPUT_PULLUP, 0) /* (D17) MMC1_SDCD */
        >;
    };

    main_rgmii2_pins_default: main-rgmii2-pins-default {
        pinctrl-single,pins = <
            AM62X_IOPAD(0x184, PIN_INPUT, 0) /* (AE23) RGMII2_RD0 */
            AM62X_IOPAD(0x188, PIN_INPUT, 0) /* (AB20) RGMII2_RD1 */
            AM62X_IOPAD(0x18c, PIN_INPUT, 0) /* (AC21) RGMII2_RD2 */
            AM62X_IOPAD(0x190, PIN_INPUT, 0) /* (AE22) RGMII2_RD3 */
            AM62X_IOPAD(0x180, PIN_INPUT, 0) /* (AD23) RGMII2_RXC */
            AM62X_IOPAD(0x17c, PIN_INPUT, 0) /* (AD22) RGMII2_RX_CTL */
            AM62X_IOPAD(0x16c, PIN_OUTPUT, 0) /* (Y18) RGMII2_TD0 */
            AM62X_IOPAD(0x170, PIN_OUTPUT, 0) /* (AA18) RGMII2_TD1 */
            AM62X_IOPAD(0x174, PIN_OUTPUT, 0) /* (AD21) RGMII2_TD2 */
            AM62X_IOPAD(0x178, PIN_OUTPUT, 0) /* (AC20) RGMII2_TD3 */
            AM62X_IOPAD(0x168, PIN_OUTPUT, 0) /* (AE21) RGMII2_TXC */
            AM62X_IOPAD(0x164, PIN_OUTPUT, 0) /* (AA19) RGMII2_TX_CTL */
        >;
    };

    main_usb1_pins_default: main-usb1-pins-default {
        pinctrl-single,pins = <
            AM62X_IOPAD(0x258, PIN_OUTPUT, 0) /* (F18) USB1_DRVVBUS */
        >;
    };
};

&cpsw3g {
    pinctrl-names = "default";
    pinctrl-0 = <&main_rgmii1_pins_default>, <&main_rgmii2_pins_default>;
};

&cpsw_port2 {
    phy-mode = "rgmii-rxid";
    phy-handle = <&cpsw3g_phy3>;
};

&cpsw3g_mdio {
    cpsw3g_phy3: ethernet-phy@3 {
        compatible = "ethernet-phy-id2000.a231", "ethernet-phy-ieee802.3-c22";
        reg = <3>;
        ti,clk-output-sel = <DP83867_CLK_O_SEL_OFF>;
        ti,rx-internal-delay = <DP83867_RGMIIDCTL_2_50_NS>;
        ti,fifo-depth = <DP83867_PHYCR_FIFO_DEPTH_4_B_NIB>;
    };
};

&i2c_som_rtc {
    enable-level-switching-mode;
};

&main_uart0 {
    pinctrl-names = "default";
    pinctrl-0 = <&main_uart0_pins_default>;
    status = "okay";
};

&main_uart1 {
    pinctrl-names = "default";
    pinctrl-0 = <&main_uart1_pins_default>;
    /* Main UART1 may be used by TIFS firmware */
    status = "okay";
};

&sdhci1 {
    vmmc-supply = <&vcc_3v3_mmc>;
    vqmmc-supply = <&vddshv5_sdio>;
    pinctrl-names = "default";
    pinctrl-0 = <&main_mmc1_pins_default>;
    ti,driver-strength-ohm = <50>;
    disable-wp;
    no-1-8-v;
    status = "okay";
};

&usbss0 {
    ti,vbus-divider;
    status = "okay";
};

&usbss1 {
    ti,vbus-divider;
    status = "okay";
};

&usb1 {
    dr_mode = "host";
    pinctrl-names = "default";
    pinctrl-0 = <&main_usb1_pins_default>;
};

